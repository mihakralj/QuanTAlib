#!csharp

#r "nuget:YahooFinanceApi" 
#r "nuget: Plotly.NET, 2.0.0-preview.18 "
#r "nuget: Plotly.NET.Interactive, 2.0.0-preview.18 "
#r "nuget:QuantLib"

using YahooFinanceApi;
using Plotly.NET;
using Plotly.NET.LayoutObjects;
using QuantLib;

#!csharp

var history = await Yahoo.GetHistoricalAsync("TQQQ", DateTime.Today.AddDays(-530), DateTime.Now, Period.Daily);
TSeries data = new();
EMA_Series slow = new(data,26);
EMA_Series fast = new(data,12);
SUB_Series macd = new(fast,slow);
EMA_Series signal = new(macd,9);
foreach (var i in history) data.Add((i.DateTime,  (double)i.Close));

#!csharp

GenericChart.GenericChart ch1 = Chart2D.Chart.Line<DateTime,double,bool>(macd.Select(x => (DateTime)x.t),macd.Select(x => (double)x.v),false,"sig").WithLineStyle(Width: 2, Color: Color.fromString("red"));
GenericChart.GenericChart ch2 = Chart2D.Chart.Line<DateTime,double,bool>(macd.Select(x => (DateTime)x.t),signal.Select(x => (double)x.v),false,"ref").WithLineStyle(Width: 1.5, Color: Color.fromString("green"));
var chart = Chart.Combine(new []{ch1,ch2}).WithSize(1200,400).WithMargin(Margin.init<int, int, int, int, int, bool>(1,1,60,1,1,false)).WithTitle("Spike");
chart
